<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Computabilis - Sistema profissional de gest√£o financeira">
    <meta name="theme-color" content="#8b5cf6">
    <title>Computabilis - Sistema Profissional</title>
    
    <link rel="manifest" href="manifest.json">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üí∞</text></svg>">
    
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: system-ui, -apple-system, sans-serif; transition: background 0.3s; }
        .container { max-width: 1200px; margin: 0 auto; padding: 1rem; }
        .card { background: rgba(0,0,0,0.4); backdrop-filter: blur(12px); border: 1px solid rgba(255,255,255,0.1); border-radius: 1rem; padding: 1.5rem; margin-bottom: 1rem; }
        .card-light { background: rgba(255,255,255,0.8); border: 1px solid rgba(139,92,246,0.2); }
        .bg-dark { background: linear-gradient(135deg, #1e1b4b 0%, #581c87 50%, #1e1b4b 100%); color: white; min-height: 100vh; }
        .bg-light { background: linear-gradient(135deg, #faf5ff 0%, #fce7f3 50%, #dbeafe 100%); color: #1f2937; min-height: 100vh; }
        .grid { display: grid; gap: 1rem; }
        .grid-3 { grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); }
        .grid-2 { grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); }
        .btn { padding: 0.75rem 1.5rem; border: none; border-radius: 0.5rem; cursor: pointer; font-weight: 600; transition: transform 0.2s; font-size: 1rem; }
        .btn:hover { transform: scale(1.05); }
        .btn-primary { background: linear-gradient(135deg, #ec4899, #8b5cf6); color: white; }
        .btn-green { background: #10b981; color: white; }
        .btn-red { background: #ef4444; color: white; }
        .btn-blue { background: #3b82f6; color: white; }
        input, select { padding: 0.75rem; border-radius: 0.5rem; border: 1px solid rgba(255,255,255,0.2); background: #000; color: #fff; width: 100%; font-size: 1rem; }
        .input-light { background: #fff; color: #000; border: 1px solid #d1d5db; }
        .text-green { color: #10b981; }
        .text-red { color: #ef4444; }
        .text-blue { color: #3b82f6; }
        .text-purple { color: #8b5cf6; }
        .text-yellow { color: #f59e0b; }
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem; flex-wrap: wrap; gap: 1rem; }
        .logo { display: flex; align-items: center; gap: 1rem; }
        .emoji { width: 48px; height: 48px; background: #f59e0b; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 24px; }
        table { width: 100%; border-collapse: collapse; }
        th, td { padding: 0.75rem; text-align: left; border-bottom: 1px solid rgba(255,255,255,0.1); }
        .table-light th, .table-light td { border-bottom: 1px solid rgba(0,0,0,0.1); }
        th { font-weight: 600; opacity: 0.7; font-size: 0.875rem; }
        .badge { display: inline-block; padding: 0.25rem 0.75rem; border-radius: 9999px; font-size: 0.875rem; font-weight: 600; }
        .badge-green { background: rgba(16,185,129,0.2); color: #10b981; }
        .badge-red { background: rgba(239,68,68,0.2); color: #ef4444; }
        .clickable { cursor: pointer; transition: transform 0.2s; }
        .clickable:hover { transform: scale(1.05); }
        .hidden { display: none; }
        @media (max-width: 768px) {
            .grid-3, .grid-2 { grid-template-columns: 1fr; }
            input, select, .btn { font-size: 16px; }
        }
    </style>
</head>
<body id="body" class="bg-dark">
    <div class="container">
        <!-- Header -->
        <div class="header">
            <div class="logo">
                <div class="emoji">üí∞</div>
                <div>
                    <h1 style="font-size: 2rem; font-weight: bold;" id="title">Computabilis</h1>
                    <p style="font-size: 0.875rem; opacity: 0.7;" id="subtitle">Sistema profissional</p>
                </div>
            </div>
            <div style="display: flex; gap: 0.5rem;">
                <select id="lang" style="width: auto; padding: 0.5rem;">
                    <option value="pt-br">üáßüá∑ PT</option>
                    <option value="en">üá∫üá∏ EN</option>
                    <option value="es">üá™üá∏ ES</option>
                </select>
                <button id="theme-btn" class="btn btn-primary">‚òÄÔ∏è</button>
            </div>
        </div>

        <!-- Cards Resumo -->
        <div class="grid grid-3">
            <div class="card" id="card-income">
                <div style="font-size: 0.875rem; opacity: 0.7; margin-bottom: 0.5rem;">üìà <span id="txt-income">Receitas</span></div>
                <div class="text-green" style="font-size: 2rem; font-weight: bold;" id="val-income">$ 0.00</div>
            </div>
            <div class="card" id="card-expense">
                <div style="font-size: 0.875rem; opacity: 0.7; margin-bottom: 0.5rem;">üìâ <span id="txt-expense">Despesas</span></div>
                <div class="text-red" style="font-size: 2rem; font-weight: bold;" id="val-expense">$ 0.00</div>
            </div>
            <div class="card" id="card-balance">
                <div style="font-size: 0.875rem; opacity: 0.7; margin-bottom: 0.5rem;">üí∞ <span id="txt-balance">Saldo</span></div>
                <div class="text-blue" style="font-size: 2rem; font-weight: bold;" id="val-balance">$ 0.00</div>
            </div>
        </div>

        <!-- Meta e Patrim√¥nio -->
        <div class="grid grid-2">
            <div class="card clickable" id="card-goal">
                <div style="font-size: 0.875rem; opacity: 0.7; margin-bottom: 0.5rem;" id="txt-goal">Meta Mensal (clique)</div>
                <input type="number" id="input-goal" class="hidden" style="font-size: 1.5rem; font-weight: bold;">
                <div class="text-purple" style="font-size: 1.5rem; font-weight: bold;" id="val-goal">$ 3000.00</div>
            </div>
            <div class="card clickable" id="card-equity">
                <div style="font-size: 0.875rem; opacity: 0.7; margin-bottom: 0.5rem;" id="txt-equity">Patrim√¥nio (clique)</div>
                <input type="number" id="input-equity" class="hidden" style="font-size: 1.5rem; font-weight: bold;">
                <div class="text-yellow" style="font-size: 1.5rem; font-weight: bold;" id="val-equity">$ 0.00</div>
            </div>
        </div>

        <!-- Estat√≠sticas -->
        <div class="card">
            <h2 style="margin-bottom: 1rem; font-size: 1.25rem; font-weight: bold;">üìä <span id="txt-stats">Estat√≠sticas</span></h2>
            <div class="grid grid-3">
                <div>
                    <div style="font-size: 0.875rem; opacity: 0.7;" id="txt-freq">Categoria + Frequente</div>
                    <div style="font-weight: bold;" id="val-freq">N/A</div>
                </div>
                <div>
                    <div style="font-size: 0.875rem; opacity: 0.7;" id="txt-avg">Ticket M√©dio</div>
                    <div style="font-weight: bold;" id="val-avg">$ 0.00</div>
                </div>
                <div>
                    <div style="font-size: 0.875rem; opacity: 0.7;" id="txt-total">Total</div>
                    <div style="font-weight: bold;" id="val-total">0</div>
                </div>
            </div>
        </div>

        <!-- Formul√°rio -->
        <div class="card">
            <h2 style="margin-bottom: 1rem; font-size: 1.25rem; font-weight: bold;">‚ûï <span id="txt-add">Adicionar</span></h2>
            <div class="grid grid-2">
                <input type="date" id="form-date">
                <select id="form-type">
                    <option value="despesa">Despesa</option>
                    <option value="receita">Receita</option>
                </select>
                <select id="form-category"></select>
                <input type="number" step="0.01" id="form-value" placeholder="Valor">
                <input type="text" id="form-desc" placeholder="Descri√ß√£o" style="grid-column: 1 / -1;">
            </div>
            <div class="grid grid-2" style="margin-top: 1rem;">
                <button id="btn-add" class="btn btn-primary">+ Adicionar</button>
                <label class="btn btn-blue" style="text-align: center; display: flex; align-items: center; justify-content: center;">
                    <span id="txt-import">Importar</span>
                    <input type="file" id="file-import" accept=".csv" style="display: none;">
                </label>
                <button id="btn-csv" class="btn btn-green">üì• CSV</button>
                <button id="btn-pdf" class="btn btn-red">üìÑ PDF</button>
            </div>
        </div>

        <!-- Tabela -->
        <div class="card">
            <h2 style="margin-bottom: 1rem; font-size: 1.25rem; font-weight: bold;">üìã <span id="txt-txs">Lan√ßamentos</span> (<span id="count-txs">0</span>)</h2>
            <div style="overflow-x: auto;">
                <table id="table">
                    <thead>
                        <tr>
                            <th id="th-date">Data</th>
                            <th id="th-type">Tipo</th>
                            <th id="th-category">Categoria</th>
                            <th id="th-desc">Descri√ß√£o</th>
                            <th id="th-value">Valor</th>
                            <th>üóëÔ∏è</th>
                        </tr>
                    </thead>
                    <tbody id="tbody"></tbody>
                </table>
                <div id="no-txs" style="text-align: center; padding: 3rem; opacity: 0.5;">Nenhum lan√ßamento</div>
            </div>
        </div>
    </div>

<script>
// Estado
let state = {
    lang: 'pt-br',
    dark: true,
    txs: [],
    goal: 3000,
    equity: 0
};

// Tradu√ß√µes
const t = {
    'pt-br': { title: 'Computabilis', subtitle: 'Sistema profissional', income: 'Receitas', expense: 'Despesas', balance: 'Saldo', goal: 'Meta Mensal (clique)', equity: 'Patrim√¥nio (clique)', stats: 'Estat√≠sticas', add: 'Adicionar', date: 'Data', type: 'Tipo', category: 'Categoria', value: 'Valor', desc: 'Descri√ß√£o', csv: 'CSV', pdf: 'PDF', import: 'Importar', txs: 'Lan√ßamentos', noTxs: 'Nenhum lan√ßamento', freq: 'Categoria + Frequente', avg: 'Ticket M√©dio', total: 'Total', receita: 'Receita', despesa: 'Despesa' },
    'en': { title: 'Computabilis', subtitle: 'Professional system', income: 'Income', expense: 'Expenses', balance: 'Balance', goal: 'Monthly Goal (click)', equity: 'Equity (click)', stats: 'Statistics', add: 'Add', date: 'Date', type: 'Type', category: 'Category', value: 'Value', desc: 'Description', csv: 'CSV', pdf: 'PDF', import: 'Import', txs: 'Transactions', noTxs: 'No transactions', freq: 'Most Frequent', avg: 'Avg Ticket', total: 'Total', receita: 'Income', despesa: 'Expense' },
    'es': { title: 'Computabilis', subtitle: 'Sistema profesional', income: 'Ingresos', expense: 'Gastos', balance: 'Saldo', goal: 'Meta Mensual (clic)', equity: 'Patrimonio (clic)', stats: 'Estad√≠sticas', add: 'Agregar', date: 'Fecha', type: 'Tipo', category: 'Categor√≠a', value: 'Valor', desc: 'Descripci√≥n', csv: 'CSV', pdf: 'PDF', import: 'Importar', txs: 'Transacciones', noTxs: 'Sin transacciones', freq: 'M√°s Frecuente', avg: 'Ticket Promedio', total: 'Total', receita: 'Ingreso', despesa: 'Gasto' }
};

const cats = ['Academia', '√Ågua', 'Aluguel', 'Beleza', 'Combust√≠vel', 'Cursos', 'Delivery', 'Educa√ß√£o', 'Farm√°cia', 'G√°s', 'Higiene Pessoal', 'Hobbies', 'Internet', 'Investimentos', 'Lazer', 'Livros', 'Luz', 'Moradia', 'Outros', 'Restaurante', 'Roupas', 'Sa√∫de', 'Sal√°rio', 'Supermercado', 'Telefone', 'Transporte', 'Uber/Taxi'];

// Init
document.getElementById('form-date').value = new Date().toISOString().split('T')[0];
cats.forEach(c => {
    const opt = document.createElement('option');
    opt.value = c;
    opt.textContent = c;
    document.getElementById('form-category').appendChild(opt);
});

// Fun√ß√µes
function calcTotals() {
    return state.txs.reduce((a, t) => {
        const v = parseFloat(t.value);
        t.type === 'receita' ? a.income += v : a.expense += v;
        return a;
    }, { income: 0, expense: 0 });
}

function updateUI() {
    const txt = t[state.lang];
    const totals = calcTotals();
    const balance = totals.income - totals.expense;
    
    // Textos
    document.getElementById('title').textContent = txt.title;
    document.getElementById('subtitle').textContent = txt.subtitle;
    document.getElementById('txt-income').textContent = txt.income;
    document.getElementById('txt-expense').textContent = txt.expense;
    document.getElementById('txt-balance').textContent = txt.balance;
    document.getElementById('txt-goal').textContent = txt.goal;
    document.getElementById('txt-equity').textContent = txt.equity;
    document.getElementById('txt-stats').textContent = txt.stats;
    document.getElementById('txt-add').textContent = txt.add;
    document.getElementById('txt-import').textContent = txt.import;
    document.getElementById('txt-txs').textContent = txt.txs;
    document.getElementById('txt-freq').textContent = txt.freq;
    document.getElementById('txt-avg').textContent = txt.avg;
    document.getElementById('txt-total').textContent = txt.total;
    document.getElementById('th-date').textContent = txt.date;
    document.getElementById('th-type').textContent = txt.type;
    document.getElementById('th-category').textContent = txt.category;
    document.getElementById('th-desc').textContent = txt.desc;
    document.getElementById('th-value').textContent = txt.value;
    document.getElementById('no-txs').textContent = txt.noTxs;
    document.getElementById('form-value').placeholder = txt.value;
    document.getElementById('form-desc').placeholder = txt.desc;
    document.getElementById('form-type').innerHTML = `<option value="despesa">${txt.despesa}</option><option value="receita">${txt.receita}</option>`;
    
    // Valores
    document.getElementById('val-income').textContent = '$ ' + totals.income.toFixed(2);
    document.getElementById('val-expense').textContent = '$ ' + totals.expense.toFixed(2);
    document.getElementById('val-balance').textContent = '$ ' + balance.toFixed(2);
    document.getElementById('val-balance').className = balance >= 0 ? 'text-blue' : 'text-red';
    document.getElementById('val-goal').textContent = '$ ' + state.goal.toFixed(2);
    document.getElementById('val-equity').textContent = '$ ' + state.equity.toFixed(2);
    document.getElementById('count-txs').textContent = state.txs.length;
    
    // Stats
    const freq = Object.entries(state.txs.reduce((a, t) => { a[t.category] = (a[t.category] || 0) + 1; return a; }, {})).sort((a, b) => b[1] - a[1])[0];
    document.getElementById('val-freq').textContent = freq ? freq[0] : 'N/A';
    const avg = state.txs.length ? (totals.income + totals.expense) / state.txs.length : 0;
    document.getElementById('val-avg').textContent = '$ ' + avg.toFixed(2);
    document.getElementById('val-total').textContent = state.txs.length;
    
    // Tabela
    const tbody = document.getElementById('tbody');
    tbody.innerHTML = '';
    if (state.txs.length === 0) {
        document.getElementById('no-txs').classList.remove('hidden');
        document.getElementById('table').classList.add('hidden');
    } else {
        document.getElementById('no-txs').classList.add('hidden');
        document.getElementById('table').classList.remove('hidden');
        state.txs.sort((a, b) => new Date(b.date) - new Date(a.date)).forEach(tx => {
            const tr = document.createElement('tr');
            tr.innerHTML = `
                <td>${tx.date}</td>
                <td><span class="badge ${tx.type === 'receita' ? 'badge-green' : 'badge-red'}">${tx.type === 'receita' ? txt.receita : txt.despesa}</span></td>
                <td>${tx.category}</td>
                <td>${tx.description || '-'}</td>
                <td style="font-weight: bold;" class="${tx.type === 'receita' ? 'text-green' : 'text-red'}">$ ${parseFloat(tx.value).toFixed(2)}</td>
                <td><button onclick="deleteTx(${tx.id})" style="background: none; border: none; cursor: pointer; font-size: 1.25rem;">üóëÔ∏è</button></td>
            `;
            tbody.appendChild(tr);
        });
    }
    
    // Theme
    document.getElementById('body').className = state.dark ? 'bg-dark' : 'bg-light';
    document.querySelectorAll('.card').forEach(c => c.className = state.dark ? 'card' : 'card card-light');
    document.querySelectorAll('input, select').forEach(i => i.className = state.dark ? '' : 'input-light');
    document.getElementById('table').className = state.dark ? '' : 'table-light';
    document.getElementById('theme-btn').textContent = state.dark ? '‚òÄÔ∏è' : 'üåô';
}

function addTx() {
    const value = document.getElementById('form-value').value;
    if (!value || parseFloat(value) <= 0) return;
    
    state.txs.push({
        id: Date.now(),
        date: document.getElementById('form-date').value,
        type: document.getElementById('form-type').value,
        category: document.getElementById('form-category').value,
        value: value,
        description: document.getElementById('form-desc').value
    });
    
    document.getElementById('form-value').value = '';
    document.getElementById('form-desc').value = '';
    document.getElementById('form-date').value = new Date().toISOString().split('T')[0];
    updateUI();
}

function deleteTx(id) {
    state.txs = state.txs.filter(t => t.id !== id);
    updateUI();
}

function exportCSV() {
    if (!state.txs.length) return alert(t[state.lang].noTxs);
    const csv = [['Data', 'Tipo', 'Categoria', 'Valor', 'Descri√ß√£o'], ...state.txs.map(t => [t.date, t.type, t.category, t.value, t.description])].map(r => r.join(',')).join('\n');
    const blob = new Blob(['\uFEFF' + csv], { type: 'text/csv;charset=utf-8;' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `computabilis_${new Date().toISOString().split('T')[0]}.csv`;
    a.click();
    URL.revokeObjectURL(url);
}

function exportPDF() {
    if (!state.txs.length) return alert(t[state.lang].noTxs);
    const txt = t[state.lang];
    const totals = calcTotals();
    const balance = totals.income - totals.expense;
    const html = `<html><head><meta charset="UTF-8"><title>Relat√≥rio</title><style>body{font-family:Arial;padding:30px;max-width:1000px;margin:0 auto}h1{color:#8b5cf6;text-align:center}table{width:100%;border-collapse:collapse;margin:20px 0}th,td{border:1px solid #ddd;padding:10px;text-align:left}th{background:#8b5cf6;color:white}tr:nth-child(even){background:#f9f9f9}</style></head><body><h1>üí∞ Computabilis</h1><p style="text-align:center">${new Date().toLocaleDateString()}</p><h2>Resumo</h2><p>${txt.income}: $ ${totals.income.toFixed(2)}</p><p>${txt.expense}: $ ${totals.expense.toFixed(2)}</p><p>${txt.balance}: $ ${balance.toFixed(2)}</p><h2>${txt.txs}</h2><table><tr><th>${txt.date}</th><th>${txt.type}</th><th>${txt.category}</th><th>${txt.desc}</th><th>${txt.value}</th></tr>${state.txs.map(e => `<tr><td>${e.date}</td><td>${e.type}</td><td>${e.category}</td><td>${e.description || '-'}</td><td>$ ${parseFloat(e.value).toFixed(2)}</td></tr>`).join('')}</table><p style="text-align:center;margin-top:40px">Pressione Ctrl+P para salvar como PDF</p></body></html>`;
    const blob = new Blob([html], { type: 'text/html' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `computabilis_${new Date().toISOString().split('T')[0]}.html`;
    a.click();
    URL.revokeObjectURL(url);
}

// Events
document.getElementById('lang').addEventListener('change', e => { state.lang = e.target.value; updateUI(); });
document.getElementById('theme-btn').addEventListener('click', () => { state.dark = !state.dark; updateUI(); });
document.getElementById('btn-add').addEventListener('click', addTx);
document.getElementById('btn-csv').addEventListener('click', exportCSV);
document.getElementById('btn-pdf').addEventListener('click', exportPDF);

document.getElementById('card-goal').addEventListener('click', () => {
    const input = document.getElementById('input-goal');
    const val = document.getElementById('val-goal');
    input.value = state.goal;
    input.classList.remove('hidden');
    val.classList.add('hidden');
    input.focus();
});

document.getElementById('input-goal').addEventListener('blur', e => {
    state.goal = parseFloat(e.target.value) || 3000;
    e.target.classList.add('hidden');
    document.getElementById('val-goal').classList.remove('hidden');
    updateUI();
});

document.getElementById('card-equity').addEventListener('click', () => {
    const input = document.getElementById('input-equity');
    const val = document.getElementById('val-equity');
    input.value = state.equity;
    input.classList.remove('hidden');
    val.classList.add('hidden');
    input.focus();
});

document.getElementById('input-equity').addEventListener('blur', e => {
    state.equity = parseFloat(e.target.value) || 0;
    e.target.classList.add('hidden');
    document.getElementById('val-equity').classList.remove('hidden');
    updateUI();
});

document.getElementById('file-import').addEventListener('change', e => {
    const file = e.target.files[0];
    if (!file) return;
    const reader = new FileReader();
    reader.onload = ev => {
        try {
            const lines = ev.target.result.split('\n');
            let imported = 0;
            for (let i = 1; i < lines.length; i++) {
                const [date, type, category, value, description] = lines[i].split(',');
                if (date && type && category && value) {
                    state.txs.push({ id: Date.now() + i, date: date.trim(), type: type.trim(), category: category.trim(), value: value.trim(), description: description?.trim() || '' });
                    imported++;
                }
            }
            if (imported) alert(`${imported} ${t[state.lang].txs}`);
            updateUI();
        } catch (err) {
            alert('Erro ao importar');
        }
    };
    reader.readAsText(file);
    e.target.value = '';
});

// Init
updateUI();

// PWA
if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('sw.js').catch(() => {});
}
</script>
</body>
</html>